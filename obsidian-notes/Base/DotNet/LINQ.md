# Группировка

#REDO 

**LINQ** содержит несколько методов группировки элементов последовательности по некоторому признаку. Основной способ группировки - это метод `GroupBy()`, который группирует значения по переданному предикату. В следующем примере имена будут сгруппированы по первой группе:

```cs
string[] names = { "Pavel", "Peter", "Andrew", "Anna", "Alice", "John" };
var groups = names
    .GroupBy(name => name[0]);
```

В некотором смысле `GroupBy` - это метод противоположный по действию методу `SelectMany`. `GroupBy` создает группы, а `SelectMany` из списка групп делает плоский список.

---

# ToDictionary и ToLookup

Нередко встречается необходимость, сгруппировав элементы, преобразовать их в структуру данных для поиска группы по ключу группировки. Это можно сделать с помощью метода `ToDictionary()`.

```cs
string[] names = { "Pavel", "Peter", "Andrew", "Anna", "Alice", "John" };

Dictionary<char, List<string>> namesByLetter = names
    .GroupBy(name => name[0])
    .ToDictionary(group => group.Key, group => group.ToList());
```

Но еще проще воспользоваться специальным методом `ToLookup()`:
```cs
string[] names = { "Pavel", "Peter", "Andrew", "Anna", "Alice", "John" };

ILookup<char, string> namesByLetter = names.ToLookup(name => name[0], name => name);

var noNames = namesByLetter['Z']; // возвращает пустое перечисление
```

`ILookup` по неизвестному ключу возвращает пустую коллекцию. Часто это удобнее, чем поведение Dictionary, который в такой ситуации бросает исключение.

---

# Синтаксис запросов LINQ

Рассмотрим следующий массив значений `string`:

```cs
var names = new string[] { "Michael", "Pam", "Jim", "Dwight",
"Angela", "Kevin", "Toby", "Creed" };
```

Для фильтрации и сортировки по имени можно использовать методы расширения и лямбда-выражения, как показано ниже:
```cs
var query = names
	.Where(name => name.Length > 4)
	.OrderBy(name => name.Length)
	.ThenBy(name => name);
```

Или можно достичь тех же результатов, используя синтаксис запросов, как показано ниже:
```cs
var query = from name in names
	where name.Length > 4
	orderby name.Length, name
	select name;
```

Компилятор самостоятельно выполнит преобразование синтаксиса запросов в методы расширения и лямбда-выражения.

Синтаксису запросов LINQ всегда требуется ключевое слово select. Метод расширения Select необязателен при использовании методов расширений и лямбда-выражений, поскольку в этом случае неявным образом будет выбран элемент целиком.

Не все методы расширения имеют эквивалентное ключевое слово на языке C#, например методы Skip и Take, которые обычно используются для постраничного
просмотра большого объема данных.

> [!Danger] Важно понимать
> Функциональность синтаксиса запросов LINQ весьма ограничена. Она предоставляет 
> только ключевые слова C# для наиболее часто используемых функций LINQ. Для доступа 
> ко всем функциям LINQ следует применять методы расширения.